import io.vertx.groovy.ext.web.Router
import io.vertx.core.Vertx
import io.vertx.core.http.HttpClient

def server = vertx.createHttpServer()

def router = Router.router(vertx)

def route = router.route('/weather/:city').handler({ routingContext ->

def city = routingContext.request().getParam('city')

def response = routingContext.response() 

def client = vertx.createHttpClient([ssl: true, trustAll: true]) 


def request = client
	.get(443, 'devru-latitude-longitude-find-v1.p.mashape.com', 
		'/latlon.php?location=Nantes', { locationResponse ->
		response.end("response ${locationResponse.statusMessage()}\n")
	})

request.putHeader('Accept', 'application/json')
request.putHeader('X-Mashape-Key', 'oz5OTrdrQnmshayy6rDZZ0D7YCBCp16qCMhjsn8QxeG5h7mHCB')

request.end()
})

server.requestHandler(router.&accept).listen(8080)
